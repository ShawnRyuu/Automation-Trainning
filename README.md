# QuickBase Utils
==========================

This repository is hooked by the CI system, which means the CI Jenkins job will start automatically upon a code commit to the master branch.

* [Release CI Jenkins Builder (itag-quickbaseutils)](http://bu-ctoauto-jenkins.prod1-ibp.a.intuit.com/jenkins/job/CTO/job/itag-quickbaseutils/ "CI Jenkins Builder")
* [Build artifacts in the Intuit Nexus](http://pprdnexusas301.corp.intuit.net/nexus/content/groups/public/com/intuit/tools/quickbase-utils/)


# Introduction

>In each round of testing activities, it always takes time and is easy to make mistake to compile all the test results that are generated by manual testing and automation testing, especially for automation because it generates huge test case results at one time, and usually some of test case have multiple records.

> If your team is using quickbase as the test case management of AUT(Appliction Under Testing), running the test case by Martini based automation script, and managing the test results in quickbase, this utility will help you in uploading automation test result to quickbase automatically.

# Author
Create by `Intuit QBO LQA Automation Team`.
This utility is open for contributions as well as any comments, suggestions, bugs or improvements.
For any issue, please don't hesitate to contact Shawn_Liu@intuit.com.

# Usage

##### 1. You need to apply for the credential to quickbase(by default the quickbase url is https://intuitcorp.quickbase.com, but you can change this url if needed), and permission of the quickkbase `Application` to edit test run as a user role.
`Application` in quickbase stands for the product under testing. It contains all the test case and test result on each build in the form of test suite and test run. Usually the `Application` is created and maintained by Project Manager, and automation just shares the same quickbase application with whole quality team.

For example, in [QuickBase](https://intuitcorp.quickbase.com), [QBO Test Case Management](https://intuitcorp.quickbase.com/db/bgwgr7jv3?a=td) is the application created for QBO related test case and test results. If you are working on this application, to use this quickbase-utils, you need to apply for the credential(username and password) of this quickbase, and be added as an user of [QBO Test Case Management](https://intuitcorp.quickbase.com/db/bgwgr7jv3?a=td) application. 

Another example in this instance of [QuickBase](https://intuitcorp.quickbase.com) is [LQA Test Cases](https://intuitcorp.quickbase.com/db/bi8zygq63) which is being used by QBO LQA automation team.

In this step, you need to get the username & password, and make sure this account has permission to your application.

In this step, you also need to get the token of this quickbase application. Please refer to FAQ about how to get it.
	 
##### 2. Prepare the test suite and test run in your quickbase application.
In quickbase, for each round of testing, we need to create a dedicated test suite and add test runs for each test case to this test suite(this means how many test cases you want to execute by automation, how many test runs there should be in the test suite). For how to do this, please refer to [Quickbase Help](https://intuitcorp.quickbase.com/user-assistance/default.html).

With this quickbase-utils, automation will upload the test case result to the corresponding test run in this suite.

In this step, you need to have the test suite done as well as the test run in it.

In this step, you also need to know the test suite database id and suite index. please refer to FAQã€€below to find how to get them.
	
##### 3. In your Martini based automation project, add quickbase-utils dependency by adding below into the dependency section of your pom.xml
```
	<dependency>
	    <groupId>com.intuit.tools</groupId>
	    <artifactId>quickbase-utils</artifactId>
	    <version>2.2.3-SNAPSHOT</version>
	</dependency>
```
##### 4. Add test case ID in the testName for all test methods as below
Usually for each test case in quickbase, we have one corresponding testNG method defined in automation script. We connect this testNG method to the quickbase test case by the test case ID which is unique number in quickbase. In automation running, this utility uploads the test result of this testNG method to quickbase by this test case ID. 
```java
	@Test(testName = "160") //testName is the default property of Test annotation in testNG, here we use its value to store test case ID in quickbase.
	public void testEditRecord() throws Exception {
	    //Add test case steps here
	}
```
##### 5. Kick off test case in command line by adding the parameters introduced in [Configuration], for example:

`mvn -B -U clean test -DQUICKBASE_UPLOADTESTRESULT=true -DQUICKBASE_USERNAME=[quickbase username] -DQUICKBASE_PASSWORD=[quickbase password] -DQUICKBASE_APPTOKEN=[application token] -DQUICKBASE_USERTOKEN=[user token] -DQUICKBASE_DATABASE=[quickbase database] -DQUICKBASE_SUITEINDEX=[suite index] -DsuiteXmlFile=[Test Suite File Path]`

- Depends on your requirement, you also can put all or part of these parameters into your test configuration properties file.
- To be more secure, you can put the `QUICKBASE_USERNAME` and `QUICKBASE_PASSWORD` into system properties or environment.

# Configuration

In this section, we explain all supported parameters in this utility.

##### 1. To enable this feature, need to do below settings

Enable the `QUICKBASE_UPLOADTESTRESULT` by adding `-DQUICKBASE_UPLOADTESTRESULT=true` in command line, or add property pair `quickbase.uploadTestResult=true` in properties file.

##### 2. Provide the QuickBase account, including url, username, password, or usertoken

- (Optional if you are using the same quickbase provided in this example)adding quickbase url by adding `-DQUICKBASE_URL="https://intuitcorp.quickbase.com/db/"` or add property pair in Martini configuration file: `quickbase.url=https://intuitcorp.quickbase.com/db/`
- (Optional) If you are using a ticket to call API_Authenticate, adding quickbase username by adding `-DQUICKBASE_USERNAME=[quickbase username]` in command line or add property pair in Martini configuration file: `quickbase.username=[quickbase username]`
- (Optional) If you are using a ticket to call API_Authenticate, adding quickbase password by adding `-DQUICKBASE_PASSWORD=[quickbase password]` in command line or add property pair in Martini configuration file: `quickbase.password=[quickbase password]`
- (Optional) If you are using a user token without API_Authenticate, adding a quickbase user token by adding `-DQUICKBASE_USERTOKEN=[user token]` in command line or add property pair in Martini configuration file: `quickbase.usertoken=[quickbase usertoken]`

##### 3. Provide the application APPTOKEN as below(please find how to get the apptoken in FAQ)

Adding `-DQUICKBASE_APPTOKEN=[application token]` in command line or add property pair in Martini configuration file: `quickbase.apptoken=[application token]`

##### 4. Provide test suite database id and test suite index(Please find the steps in FAQ to get the database and suite index)

`-DQUICKBASE_DATABASE=[quickbase database]` in command line or add property pair in Martini configuration file: `quickbase.database=xxxx`
`-DQUICKBASE_SUITEINDEX=[suite index]` in command line or add property pair in Martini configuration file: `quickbase.suiteIndex=[suite index]`

##### 5. Provide additional filter for test case

It's possible that in one test suite, there are multiple references for one same test case ID. For example, in a LQA test suite, one test case can have multiple instances for each supported locales. In this situation, we need additional filter to locate the test case that test script really needs to update.

To enable this filter, just adding `-DQUICKBASE_TESTLOCALE=[test locale]` to the command line or put `quickkbase.testLocale=[test locale]` into the test properties file.
	
# FAQ

##### 1. What makes test case id invalid?

The test case id is the unique identifier of one test case in quickbase. If will be invalid if user gives a wrong test case number by mistake, or the test case removed.

##### 2. What would happen if upload same test case result multiple times?

Every time to upload test result, it will overwrite the test run result status in the application of quickbase. 

##### 3. What is [user token](http://www.quickbase.com/quickbase-blog/july-2016-release-notes)? How can I get my user token for some a application?

You can create your own user tokens in QuickBase and use them to run APIs and automation with your permissions. Many API calls that use a ticket can instead take a parameter called `usertoken`. The user token parameter can be used with any API that doesn't post to a db/main URL, and also with API_GrantedDBs.
To create a new user token as below:
- Login to QuickBase, On the user dropdown on the global bar, choose `My preferences`.
- Under `My User Information`, click the link for `Manage` my user tokens for realm ...
- Click the `New user token` button. 
- Click `OK`.
- In the `Basics` section, enter a Name and a Description for your token. 
- In the `Assign token to apps` section, click the dropdown arrows to select which apps you want to assign this token to. You can assign a token to as many as 20 apps. 
- Click `Save`. The new token appears in the list of user tokens. API calls containing this token can now interact with the application. 

##### 4. What is application token? How can I get my application's token?

Application token is the application's unique ID in quickbase. To get this property, you need to login as administrator of this application. You can find your application token as below:
- Login to QuickBase, in the `App bar`, select the application which you are going to test, click `SETTINGS`, then click `App properties`.
- Click `Advanced settings` to expand the section, if needed.
- Under `Application Tokens`, click the `Manage Application Token` link, you will find the application token string.

##### 5. What is test suite database? how can I get my test suite's data base?

Quickbase creates separate internal database for test suites under each application. you can find your test suite's data base id as below:
- Open the test suite in browser, for example, my test suite is https://intuitcorp.quickbase.com/db/bi9b5xkmk?a=q&qid=-1000070
- In this URL, the string between `/db/` and `?` is the database id, that is `bi9b5xkmk`.

##### 6. What is test suite index? how can I get my test suite index?
In quickbase, one database can have multiple test suites. So we need to specify the test suite index before we try to search or update the test run.
You can find the test suite index as below:
- Open the test suite in browser, for example, my test suite is https://intuitcorp.quickbase.com/db/bi9b5xkmk?a=q&qid=-1000070
- In the top left corner of this suite, you can find the `Related LQA Test Suite is  '7'`, that means this suite index is `7`.
![suite index screenshot](suite-index-intro.png)

##### 7. By this utility, what will be uploaded into the test suite?
In the test suite, we have added test runs for each of test case, so when automation running, this utility will upload the test result of each test method to corresponding test run. The test result of each test method can be `Automation SUCCESS`, `Automation FAILURE`, and `Automation SKIP` (which respectively mean test case `passed`, `failed`, `skipped` - because of precondition failure), so you can find these status in `Status` column of each test run as below (highlighted in red box):
![test run status screenshot](test-result-by-automation.png)
